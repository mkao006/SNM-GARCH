########################################################################
## Example data. This is a commodity return, but can't remember what it
## is now.
########################################################################
rii <- c(395, 399, 415, 419, 433, 442, 442, 442, 442, 442, 463, 470,
         470, 480, 505, 515, 519, 535, 523, 498, 487, 455, 428, 379,
         343, 324, 325, 312.5, 299, 292, 290, 287, 270, 254, 258, 266,
         260, 270, 282, 282, 280, 269, 260, 275, 298, 290, 283, 273,
         257, 253, 253, 256, 253, 256, 273, 272, 252, 250, 228, 224,
         225, 220, 221, 222, 223, 223, 210, 210, 210, 210, 210, 225,
         240, 230, 216, 202, 200, 204, 181, 186, 173, 175, 174, 167,
         173, 187, 198, 199, 198, 196, 191, 204, 250, 267, 254, 256,
         292, 306, 294, 288, 257, 269, 274, 269, 273, 273, 272, 260,
         264, 271, 277, 293, 311, 331, 351, 332, 321, 304, 270, 272,
         276, 300, 289, 276, 260, 255, 256, 260, 259, 281, 272, 264,
         305, 326, 311, 286, 288, 293, 306, 298, 290, 277, 274, 270,
         276, 278, 277, 279, 274, 266, 279, 269, 256, 250, 252, 256,
         262, 254, 230, 206, 185, 189, 210, 210, 206, 257, 323, 315,
         354, 363, 274, 269, 235, 216, 226, 250, 259.75, 261.75, 264.5,
         260.5, 274.75, 286.25, 283, 281.5, 287.75, 326, 345.6, 340.67,
         359.75, 382.6, 340.5, 341.25, 364.4, 367, 362.5, 325.8, 332.25,
         341.5, 358, 335.5, 328.4, 312.75, 315, 313.67, 356, 347, 323.4,
         299.33, 324.5, 323.2, 320, 285, 270.2, 265.75, 251.75, 263.5,
         293.5, 297, 295, 311, 318.5, 331, 323, 323, 322, 298.25,
         270.33, 282.5, 301.67, 280, 256.2, 235.5, 244.25, 254.75,
         255.75, 251, 233, 217, 227.5, 231, 247.5, 243, 228.8, 217,
         198.78, 197.86, 191, 187.09, 178.14, 186.73, 184.86, 183.57,
         184.43, 185.1, 177.09, 162.1, 164.26, 167.76, 169.73, 168.74,
         173, 170.87, 170, 179.38, 191.13, 194.35, 189.29, 189.5, 198.3,
         202, 199.61, 191.32, 188.48, 185.48, 187.19, 185.27, 199.74,
         198.75, 196.95, 195.18, 197.73, 203.67, 199.48, 196.43, 202.86,
         204, 201.75, 197, 207.45, 213.25, 240.35, 253.41, 251.57,
         244.23, 240.32, 252.55, 252, 253.52, 262.32, 278.43, 288.38,
         292.35, 295, 299.14, 295.27, 287.05, 278.71, 283.48, 287.41,
         290.71, 278.95, 277.27, 284.45, 296.4, 297.74, 298.5, 301.26,
         305.59, 312.43, 313.39, 312.9, 309.64, 300.59, 309.29, 313.48,
         316.05, 326.18, 322.29, 320.61, 326.29, 332.55, 331.48, 330,
         335.3, 356.5, 378, 393.48, 481.14, 672.64, 1015.21, 1009.32,
         834.6, 799, 737, 722, 624, 563.25, 550.75, 615.25, 634, 625.25,
         577.25, 540.75, 548.6, 623, 576.25, 593.67, 566.25, 566.25,
         606, 598, 584.75, 540.13, 502.23, 472.48, 458.55, 470.68,
         486.86, 519.95, 533.13, 543.14, 536.78, 528.38, 532.8, 508.96,
         500.57, 500.55, 518.09, 546.19, 577.3, 615.55, 602.14, 609.09,
         580.91)

## Take the log return and model
rii <- diff(log(rii))
trii <- rii
class(trii) <- "mgarch"
rii.t0 <- garchFit(data = rii, cond.dist = "snorm", include.mean = FALSE)
rii.t1 <- garchFit(data = rii, cond.dist = "sged", include.mean = FALSE)
rii.t2 <- garchFit(data = rii, cond.dist = "sstd", include.mean = FALSE)
(rii.mg <- cnmms(trii, plot = "gradient", grid = 300, verb = 4))

## The log likelihoods and summary
rii.t0@fit$llh
rii.t1@fit$llh
rii.t2@fit$llh
summary(rii.mg)


## This is the S&P data which has very large gradient
library(tseries)
sp <- get.hist.quote("SPY", quote = "Open",
                     end = "2006-01-02",
                     start = "2002-12-30",
                     provider = "yahoo")


## tsp <- diff(log(as.numeric(sp)))[1:300]
tsp <- c(0.00227557271935197, 0.0097263829431915, 0.0229204515331061,
         0.00362339128242084, 0.0180302484036057, -0.00756351525724508,
         -0.00412999174147188, 0.0014148122292541, 0.0171442012474099,
         -0.00912856040999888, 0.00912856040999888, -0.0111805077793603,
         -0.0164590341497801, -0.00131969666134424, -0.0233811586270276,
         -0.000225326724702768, -0.00180444393158385,
         -0.0328161617332769, -0.00116713365256338,
         -0.00245542362478091, 0.0159111422428335, -0.0308904870193389,
         0.0233729589891496, -0.00968219870536124, 0.00514440512544656,
         -0.0162241978685138, 0.00637998383373617, -0.0172243968478654,
         0.0108444130141292, -0.0144454251877235, -0.0122196185065349,
         0.00267444846987974, 0.0258852079876792, 0.00930239266231325,
         -0.00129009576328531, -0.00978839114367158,
         0.00649698109572494, -0.023589371155464, 0.012816849104782,
         -0.00381588824580614, 0.00915746424397579, 0.00930896959765892,
         -0.015484027813514, -0.016090644949136, 0.00314237628653657,
         -0.0153213113797994, 0.0120578770457813, -0.0136520891683274,
         -0.0135922023375503, 0.0221465744342089, 0.0242829577930177,
         -0.00882744608487496, 0.0432632968026239, 0.00149056955878457,
         0.000572704900826615, 0.0166926035724826, -0.00882258861517915,
         -0.0146489229757245, 0.00940913424744139, -0.0133365968446517,
         0.000809857162328953, -0.0130370837318896,
         -0.00117233307682341, 0.0265077155991236, 0.015078795987634,
         -0.00496334916273966, 0.0213690516388141, -0.0228402226165434,
         0.000679270942002042, -0.0144773118472683, 0.0122112786999562,
         -0.00785746797284137, 0.0155411215944632, 0.0119721709704548,
         -0.0180690623867665, 0.0175127960320989, -0.00849356916524968,
         0.0278902539818322, -0.000982801061907956,
         -0.00251599979576511, -0.00946414019115416, 0.0186225120980019,
         -0.00249932213775228, 0.00010879617048154,
         -0.00392413845613415, 0.0206460341101264, -0.0046110209840835,
         0.00407594686355317, -0.00968061771072382, 0.00334502604860276,
         0.00719157288280048, 0.0109558081426515, 0.00590656711406012,
         -0.00210548556568568, 0, -0.00782907088250617,
         -0.0142271212901317, -0.00767861881288567, 0.00907819916730901,
         0.00622052627900693, -0.00246213259316175, 0.0269643616383552,
         0.00031294007453031, 0.000208572323209033, 0.0168540410945308,
         -0.00390384716047443, 0.00523588281006493, 0.00937634264371745,
         0.0182938059803979, -0.0163682923375932, -0.00314354058998134,
         0.00708433283693477, 0.0159074936598032, -0.00139054452283371,
         -0.00648155033720776, 0.020888746448656, -0.00767116271670165,
         0.00344946875325736, -0.0123745577485277, -0.00940759540345404,
         -0.0124451446888827, 0.00315120972328486, -0.00764101318388377,
         0.00987134663073164, -0.00538154317013273, -0.0099248781125425,
         0.0155089324214801, 0.00303275606490239, 0.005837375673865,
         0.00849368084032687, 0.00417039627372695, -0.0107592191517396,
         -0.00451739964120357, 0.0180472518734511, 0.00177707619083822,
         -0.00563827597835331, -0.0166037021000447, -0.0013120050325286,
         0.00433315536670431, -0.00767138111606513, 0.00525519147789488,
         0.00783136532594675, -0.0133905851821652, 0.0171837620201165,
         -0.00229415092391072, -0.005407042311246, 0.00380800139487203,
         -0.00793296322752202, -0.00891145137906957,
         0.00101667353206114, -0.0176324404154373, 0.00495203735589111,
         0.011765443406432, -0.000610438517277601, 0.00456923168929446,
         0.0111823056116664, -0.00723912270552063, 0.00262017684922622,
         0.0057203226885294, 0.00757654905382577, -0.00398050082740653,
         0.00754945474951274, 0.00690338047307471, -0.0202528514820033,
         -0.00210832867615451, 0.00551241686519521, 0.00349214622788718,
         0.00208944904632968, 0.010185502148004, 0.013583049505014,
         0.000679183065937394, -0.00155309679830573,
         0.000970968131435157, 0.0031975222243501, -0.00815934589839351,
         -0.00420271351138091, -0.00186265433001687,
         0.00596783065526818, -0.0028327247269484, 0.0121531805489061,
         -0.000773395243499841, 0.0083787267271731, -0.0137120727025355,
         -0.00253115399934511, 0.00515289653131124, -0.0167216530070275,
         -0.00961117133452039, -0.00139483932149442,
         0.00179300775199831, -0.00239139213207551, 0.0167189925925086,
         0.0169264741546993, -0.00183442001719225, -0.00212827786632541,
         0.0103088730283751, 0.00525788697556617, -0.00583315065394263,
         0.004210935497869, 0.000859147587570774, 0.0100636945429002,
         -0.0112093887678961, 0.00751847462657729, -0.00971806428594846,
         0.00353610537144533, -0.00756527429121601, -0.0110188626950851,
         -0.000583317146618967, 0.00881062968215485,
         0.00231080403231498, 0.0075688984093043, 0.00968852563380906,
         -0.00369336089142092, 0.00331518181912571, 0.00226693211277595,
         -0.00472858834544621, 0.00104220957844348, 0.00980030459829262,
         -0.0084754250631498, -0.0061661249297984, 0.00133130487521527,
         0.00738499853228536, 0.00367214762253809, -0.0141027371641496,
         0.00314061642869756, -0.0115641370892883, -0.00028841994143125,
         0.00230503367521706, 0.00430766951467376, 0.00988507241317205,
         0.00650485442378823, -0.00131640827661084, 0.00534886087354369,
         0.00494796322926661, 0.00251127881594915, -0.00446886508546651,
         -0.000466657341988252, -0.00355373047711893,
         0.0108089013582902, -0.0105278840738778, -0.000843288876397175,
         0.0120197114452356, 0.0110528895331292, -0.0137424343957608,
         0.00352276251950201, 0.00452426790838079, 0.00688549885819256,
         -0.00467697674950163, 0.00632246573948692,
         0.000365296807714799, 0.00173333984920632, 0.00354852289923446,
         0.00895163986499714, 0.00116953816578658, 0.00466452227158509,
         -0.000447567478267352, 0.00419924673354455,
         0.00204854224389628, 0.00762279883296735, -0.00371550321278846,
         -0.00248469379761396, 0.00478639453049468,
         -0.00292229563732427, 0.0071577206576432, 0.00412987714091706,
         0.00428753336515353, -0.00349864784411658, 0.00881062968215485,
         -0.00121665088441336, -0.00531846582566775, 0.0118190304287609,
         -0.00667449277119836, -0.0124268685903743,
         -0.000352298752983593, 0.0015843679047034,
         0.000351741122162963, -0.00484731923432502,
         -0.000176709666478203, 0.00220662960803164, 0.0109606954643313,
         -0.00340686068764118, 0.0049753517725355, 0.00970460783350457,
         -0.00129427517096836, 0.000258989080741401,
         0.00301659353942618, 0.00111813541086381, -0.00733362503394108,
         -0.00225401049049712, -0.00827927514561466,
         0.00166134782233396, 0.00130964352765162, 0.00504787842980736,
         0.00208134668840554, 0.00440853028476607, -0.0059691340348289,
         0.00406979823117659, -0.00259583082511394, 0.00793928919979514,
         -0.0107156227547787, -0.003306938876527)

tmsp <- tsp
class(tmsp) <- "mgarch"
sp.t0 <- garchFit(data = tsp, cond.dist = "snorm", include.mean = FALSE)
sp.t1 <- garchFit(data = tsp, cond.dist = "sged", include.mean = FALSE)
sp.t2 <- garchFit(data = tsp, cond.dist = "sstd", include.mean = FALSE)
(sp.mg <- cnmms(tmsp, plot = "gradient", grid = 1000, verb = 4))

summary(sp.mg)
