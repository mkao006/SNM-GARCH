########################################################################
## Example data. This is a commodity return, but can't remember what it
## is now.
########################################################################
rii <- c(395, 399, 415, 419, 433, 442, 442, 442, 442, 442, 463, 470,
         470, 480, 505, 515, 519, 535, 523, 498, 487, 455, 428, 379,
         343, 324, 325, 312.5, 299, 292, 290, 287, 270, 254, 258, 266,
         260, 270, 282, 282, 280, 269, 260, 275, 298, 290, 283, 273,
         257, 253, 253, 256, 253, 256, 273, 272, 252, 250, 228, 224,
         225, 220, 221, 222, 223, 223, 210, 210, 210, 210, 210, 225,
         240, 230, 216, 202, 200, 204, 181, 186, 173, 175, 174, 167,
         173, 187, 198, 199, 198, 196, 191, 204, 250, 267, 254, 256,
         292, 306, 294, 288, 257, 269, 274, 269, 273, 273, 272, 260,
         264, 271, 277, 293, 311, 331, 351, 332, 321, 304, 270, 272,
         276, 300, 289, 276, 260, 255, 256, 260, 259, 281, 272, 264,
         305, 326, 311, 286, 288, 293, 306, 298, 290, 277, 274, 270,
         276, 278, 277, 279, 274, 266, 279, 269, 256, 250, 252, 256,
         262, 254, 230, 206, 185, 189, 210, 210, 206, 257, 323, 315,
         354, 363, 274, 269, 235, 216, 226, 250, 259.75, 261.75, 264.5,
         260.5, 274.75, 286.25, 283, 281.5, 287.75, 326, 345.6, 340.67,
         359.75, 382.6, 340.5, 341.25, 364.4, 367, 362.5, 325.8, 332.25,
         341.5, 358, 335.5, 328.4, 312.75, 315, 313.67, 356, 347, 323.4,
         299.33, 324.5, 323.2, 320, 285, 270.2, 265.75, 251.75, 263.5,
         293.5, 297, 295, 311, 318.5, 331, 323, 323, 322, 298.25,
         270.33, 282.5, 301.67, 280, 256.2, 235.5, 244.25, 254.75,
         255.75, 251, 233, 217, 227.5, 231, 247.5, 243, 228.8, 217,
         198.78, 197.86, 191, 187.09, 178.14, 186.73, 184.86, 183.57,
         184.43, 185.1, 177.09, 162.1, 164.26, 167.76, 169.73, 168.74,
         173, 170.87, 170, 179.38, 191.13, 194.35, 189.29, 189.5, 198.3,
         202, 199.61, 191.32, 188.48, 185.48, 187.19, 185.27, 199.74,
         198.75, 196.95, 195.18, 197.73, 203.67, 199.48, 196.43, 202.86,
         204, 201.75, 197, 207.45, 213.25, 240.35, 253.41, 251.57,
         244.23, 240.32, 252.55, 252, 253.52, 262.32, 278.43, 288.38,
         292.35, 295, 299.14, 295.27, 287.05, 278.71, 283.48, 287.41,
         290.71, 278.95, 277.27, 284.45, 296.4, 297.74, 298.5, 301.26,
         305.59, 312.43, 313.39, 312.9, 309.64, 300.59, 309.29, 313.48,
         316.05, 326.18, 322.29, 320.61, 326.29, 332.55, 331.48, 330,
         335.3, 356.5, 378, 393.48, 481.14, 672.64, 1015.21, 1009.32,
         834.6, 799, 737, 722, 624, 563.25, 550.75, 615.25, 634, 625.25,
         577.25, 540.75, 548.6, 623, 576.25, 593.67, 566.25, 566.25,
         606, 598, 584.75, 540.13, 502.23, 472.48, 458.55, 470.68,
         486.86, 519.95, 533.13, 543.14, 536.78, 528.38, 532.8, 508.96,
         500.57, 500.55, 518.09, 546.19, 577.3, 615.55, 602.14, 609.09,
         580.91)

## Take the log return and model
rii <- diff(log(rii))
trii <- rii
class(trii) <- "mgarch"
rii.t0 <- garchFit(data = rii, cond.dist = "snorm", include.mean = FALSE)
rii.t1 <- garchFit(data = rii, cond.dist = "sged", include.mean = FALSE)
rii.t2 <- garchFit(data = rii, cond.dist = "sstd", include.mean = FALSE)
(rii.mg <- cnmms(trii, plot = "gradient", grid = 300, verb = 4))

## The log likelihoods and summary
rii.t0@fit$llh
rii.t1@fit$llh
rii.t2@fit$llh
summary(rii.mg)


## This is the S&P data which has very large gradient
library(tseries)
sp <- get.hist.quote("SPY", quote = "Open",
                     end = "2006-01-02",
                     start = "2002-12-30",
                     provider = "yahoo")


## tsp <- diff(log(as.numeric(sp)))

tsp <- c(0.00227557271935197, 0.0097263829431915, 0.0229204515331061,
         0.00362339128242084, 0.0180302484036057, -0.00756351525724508,
         -0.00412999174147188, 0.0014148122292541, 0.0171442012474099,
         -0.00912856040999888, 0.00912856040999888, -0.0111805077793603,
         -0.0164590341497801, -0.00131969666134424, -0.0233811586270276,
         -0.000225326724702768, -0.00180444393158385,
         -0.0328161617332769, -0.00116713365256338,
         -0.00245542362478091, 0.0159111422428335, -0.0308904870193389,
         0.0233729589891496, -0.00968219870536124, 0.00514440512544656,
         -0.0162241978685138, 0.00637998383373617, -0.0172243968478654,
         0.0108444130141292, -0.0144454251877235, -0.0122196185065349,
         0.00267444846987974, 0.0258852079876792, 0.00930239266231325,
         -0.00129009576328531, -0.00978839114367158,
         0.00649698109572494, -0.023589371155464, 0.012816849104782,
         -0.00381588824580614, 0.00915746424397579, 0.00930896959765892,
         -0.015484027813514, -0.016090644949136, 0.00314237628653657,
         -0.0153213113797994, 0.0120578770457813, -0.0136520891683274,
         -0.0135922023375503, 0.0221465744342089, 0.0242829577930177,
         -0.00882744608487496, 0.0432632968026239, 0.00149056955878457,
         0.000572704900826615, 0.0166926035724826, -0.00882258861517915,
         -0.0146489229757245, 0.00940913424744139, -0.0133365968446517,
         0.000809857162328953, -0.0130370837318896,
         -0.00117233307682341, 0.0265077155991236, 0.015078795987634,
         -0.00496334916273966, 0.0213690516388141, -0.0228402226165434,
         0.000679270942002042, -0.0144773118472683, 0.0122112786999562,
         -0.00785746797284137, 0.0155411215944632, 0.0119721709704548,
         -0.0180690623867665, 0.0175127960320989, -0.00849356916524968,
         0.0278902539818322, -0.000982801061907956,
         -0.00251599979576511, -0.00946414019115416, 0.0186225120980019,
         -0.00249932213775228, 0.00010879617048154,
         -0.00392413845613415, 0.0206460341101264, -0.0046110209840835,
         0.00407594686355317, -0.00968061771072382, 0.00334502604860276,
         0.00719157288280048, 0.0109558081426515, 0.00590656711406012,
         -0.00210548556568568, 0, -0.00782907088250617,
         -0.0142271212901317, -0.00767861881288567, 0.00907819916730901,
         0.00622052627900693, -0.00246213259316175, 0.0269643616383552,
         0.00031294007453031, 0.000208572323209033, 0.0168540410945308,
         -0.00390384716047443, 0.00523588281006493, 0.00937634264371745,
         0.0182938059803979, -0.0163682923375932, -0.00314354058998134,
         0.00708433283693477, 0.0159074936598032, -0.00139054452283371,
         -0.00648155033720776, 0.020888746448656, -0.00767116271670165,
         0.00344946875325736, -0.0123745577485277, -0.00940759540345404,
         -0.0124451446888827, 0.00315120972328486, -0.00764101318388377,
         0.00987134663073164, -0.00538154317013273, -0.0099248781125425,
         0.0155089324214801, 0.00303275606490239, 0.005837375673865,
         0.00849368084032687, 0.00417039627372695, -0.0107592191517396,
         -0.00451739964120357, 0.0180472518734511, 0.00177707619083822,
         -0.00563827597835331, -0.0166037021000447, -0.0013120050325286,
         0.00433315536670431, -0.00767138111606513, 0.00525519147789488,
         0.00783136532594675, -0.0133905851821652, 0.0171837620201165,
         -0.00229415092391072, -0.005407042311246, 0.00380800139487203,
         -0.00793296322752202, -0.00891145137906957,
         0.00101667353206114, -0.0176324404154373, 0.00495203735589111,
         0.011765443406432, -0.000610438517277601, 0.00456923168929446,
         0.0111823056116664, -0.00723912270552063, 0.00262017684922622,
         0.0057203226885294, 0.00757654905382577, -0.00398050082740653,
         0.00754945474951274, 0.00690338047307471, -0.0202528514820033,
         -0.00210832867615451, 0.00551241686519521, 0.00349214622788718,
         0.00208944904632968, 0.010185502148004, 0.013583049505014,
         0.000679183065937394, -0.00155309679830573,
         0.000970968131435157, 0.0031975222243501, -0.00815934589839351,
         -0.00420271351138091, -0.00186265433001687,
         0.00596783065526818, -0.0028327247269484, 0.0121531805489061,
         -0.000773395243499841, 0.0083787267271731, -0.0137120727025355,
         -0.00253115399934511, 0.00515289653131124, -0.0167216530070275,
         -0.00961117133452039, -0.00139483932149442,
         0.00179300775199831, -0.00239139213207551, 0.0167189925925086,
         0.0169264741546993, -0.00183442001719225, -0.00212827786632541,
         0.0103088730283751, 0.00525788697556617, -0.00583315065394263,
         0.004210935497869, 0.000859147587570774, 0.0100636945429002,
         -0.0112093887678961, 0.00751847462657729, -0.00971806428594846,
         0.00353610537144533, -0.00756527429121601, -0.0110188626950851,
         -0.000583317146618967, 0.00881062968215485,
         0.00231080403231498, 0.0075688984093043, 0.00968852563380906,
         -0.00369336089142092, 0.00331518181912571, 0.00226693211277595,
         -0.00472858834544621, 0.00104220957844348, 0.00980030459829262,
         -0.0084754250631498, -0.0061661249297984, 0.00133130487521527,
         0.00738499853228536, 0.00367214762253809, -0.0141027371641496,
         0.00314061642869756, -0.0115641370892883, -0.00028841994143125,
         0.00230503367521706, 0.00430766951467376, 0.00988507241317205,
         0.00650485442378823, -0.00131640827661084, 0.00534886087354369,
         0.00494796322926661, 0.00251127881594915, -0.00446886508546651,
         -0.000466657341988252, -0.00355373047711893,
         0.0108089013582902, -0.0105278840738778, -0.000843288876397175,
         0.0120197114452356, 0.0110528895331292, -0.0137424343957608,
         0.00352276251950201, 0.00452426790838079, 0.00688549885819256,
         -0.00467697674950163, 0.00632246573948692,
         0.000365296807714799, 0.00173333984920632, 0.00354852289923446,
         0.00895163986499714, 0.00116953816578658, 0.00466452227158509,
         -0.000447567478267352, 0.00419924673354455,
         0.00204854224389628, 0.00762279883296735, -0.00371550321278846,
         -0.00248469379761396, 0.00478639453049468,
         -0.00292229563732427, 0.0071577206576432, 0.00412987714091706,
         0.00428753336515353, -0.00349864784411658, 0.00881062968215485,
         -0.00121665088441336, -0.00531846582566775, 0.0118190304287609,
         -0.00667449277119836, -0.0124268685903743,
         -0.000352298752983593, 0.0015843679047034,
         0.000351741122162963, -0.00484731923432502,
         -0.000176709666478203, 0.00220662960803164, 0.0109606954643313,
         -0.00340686068764118, 0.0049753517725355, 0.00970460783350457,
         -0.00129427517096836, 0.000258989080741401,
         0.00301659353942618, 0.00111813541086381, -0.00733362503394108,
         -0.00225401049049712, -0.00827927514561466,
         0.00166134782233396, 0.00130964352765162, 0.00504787842980736,
         0.00208134668840554, 0.00440853028476607, -0.0059691340348289,
         0.00406979823117659, -0.00259583082511394, 0.00793928919979514,
         -0.0107156227547787, -0.003306938876527, -0.0204304393917187,
         -0.00597869090034475, 0.00482143791144196,
         -0.00437403062913599, 0.00357207023863815, 0.00462469696554013,
         -0.00257651957202487, -0.016775455068589, -0.00262693207816156,
         -0.00609563821668591, 0.00455249807476399, 0.00796240182154317,
         0.00602005502006442, 0.00598403071775699, 0.00612545747675686,
         0.00070777672599931, 0.0152714921585666, -0.00305317112476455,
         0.00322735680714192, 0.00104447742109226, 0.00399375422312342,
         -0.00721773645188239, 0.00591717702808925, -0.0232599242995866,
         0.00743168951691686, -0.000617202329693534,
         0.00149825965540984, 0.00465668811441855, -0.0166169635773894,
         0.00249243497375851, 0.0171004607780283, 0.000698934153911424,
         -0.00236086324843843, -0.00298088945959663,
         -0.0103262026958344, -0.00489128993329313,
         -0.00715758625212271, 0.00787053521735448, 0.00142437485134206,
         -0.00347547469201981, -0.00716720502226842,
         -0.0161337678851776, 0.000182731841531947, 0.00100442870153028,
         0.00173254956027336, 0.00172955302319444, -0.00968751864280026,
         0.00549502252736378, 0.00918230007247445, -0.00954769698893632,
         0.00473977735397124, 0.00507937600002073, -0.00571611591328747,
         0.0158876784726383, 0.00785017412291822, 0.00168686505130733,
         -0.00239797619238402, 0.00505566733858398,
         -0.00194828258581126, 0.00150582428028745, 0.0039750946738355,
         0.00825290022217384, 0.0012233486321227, -0.00411289138077642,
         -0.00193101086949365, 0.00070261727815879,
         0.000877577941358787, -0.0013166558847475,
         -0.00510744329712587, 0.00422870861843716,
         -0.00546545789268382, 0.00423393064343713, 0.00832717263052274,
         -0.00131021549948329, 0.000960992517062387,
         -0.00868236105347275, 0.00474517586336454, 0.00157673473450792,
         -0.00958628334094769, -0.00700574851355551,
         -0.00499599576053456, 0, -0.00080526108230039,
         -0.00179179406476226, 0.00358038334501209,
         -0.00591452571007878, 0.00430493938385546,
         -0.00152254742591396, -0.00737678767984384,
         -0.00198843160238127, 0.0116034582756352, -0.0222452431828044,
         0.00237464720227631, -0.00393035559199628,
         -0.00128299137833654, 0.00457457339383716, 0.0089963803636417,
         -0.00199221292007046, -0.00117908498536057,
         0.00669322325088295, -0.00941950629173594, 0.00363339485922243,
         -0.0244138410418486, -0.00568368639304762, 0.00270610905587709,
         0.00344202395738158, 0, -0.0054008884427148,
         0.000373412999111089, 0.0149152795159795, -0.00211718217806212,
         0.0118171118188908, -0.00182298838199024, 0.00853929607582327,
         0.000813780053047886, -0.00280581258428825,
         0.00569390123436175, 0.00216060580990529, 0.0001798399429358,
         -0.00504778428945407, 0.00261721190863984, 0.00261037998716063,
         0.00975093828771367, 0.00186774635165499, 0.000710605821339527,
         -0.000444069459759611, -0.000444266745056154,
         0.00699644177081904, -8.82573585148094e-05, 0,
         -0.00397966477041578, 0.000885739650467343,
         -0.00248205073793795, 0.000709786206713581,
         -0.00221975673831309, -0.00803217169726445,
         -0.00386048870168665, -0.000629864599939189,
         -0.00171163502893457, 0.00270124421410056, 0.00305261504779075,
         0.00634468863551252, 0.0162576473539762, -0.00219346435828172,
         -0.000702925958123046, 0.00534737193554502,
         -0.0108118664076233, -0.00327535370051102,
         -0.00515602529043946, 0.00710482562374448, -0.0117501796982786,
         -0.0059272737520466, -0.00117164629689093, 0.0101387078165613,
         -0.014748468770331, 0.00370755952122614, 0.00360393218257649,
         -0.0130353977598769, 0.00345643422157149, 0.0112862919846703,
         0.0124912402175132, 0.00301018376922713, 0.00388212945650768,
         0.000968182093848746, 0.0118934502092998, -0.00217571122770277,
         0.0195839412567036, -0.000598213922040181,
         0.000854481808805652, -0.000170837960610903,
         0.00102459025356794, 0.00671914073710855, 0.00448260572143511,
         -0.00118213304317738, 8.44844337937189e-05,
         0.00135078112560638, 0.00143320852421347, -0.0129734299355579,
         0.00646535642181423, 0.00287891816114705, 0.0020271989373315,
         0.00235988310109114, -0.00667260383578316, 0.00135501375745939,
         0.00792383813812947, 0.00176167152645501,
         -0.000838504157798958, 0.00234604213175249,
         -0.0107699820993767, -0.000592341883196568,
         0.00658063625080807, 0.00703874198147592, 0.00350087879440864,
         0.00431750919770391, 0.000165686356107919, -0.0104922271554342,
         0.00242464898686556, -0.00125339477449327, 0.00650056460309312,
         0.004062181751741, 0.00272648576384782, -0.00463116937556762,
         0.00364057989387145, 0.00263939447188033,
         -0.000824062675393478, 0.0021411520985879,
         -0.00909022043301722, -0.0143815187730461,
         -0.00252972560913811, 0.00446485725504342,
         -0.00530952323988654, 0.00253186058112931,
         -0.00202497537977209, 0.00202497537977209,
         -0.00566334297592608, 0.000677908677770844, 0.0116221621488135,
         -0.0129784393762993, -0.000848608333343215,
         -0.00596050811005977, -0.0015384618419052, 0.00350083609052199,
         -0.00110869483873888, 0.00255667430896978, 0.00390758227420296,
         0.00254022151835898, 0.00682654035320152, 0,
         -0.0005040746137146, 0.0104494158743407, -0.000665502062662249,
         0.00207822511309352, -0.0063312440744161, 0.000334224602042354,
         0.0082366620658787, 0.000911010870908058, 0.0010755802964697,
         0.00247770196130759, -0.00819982231377292,
         -0.00283168341125073, -0.0081229772943141, 0.00260318407071658,
         0.00860094651265442, 0.00729023194000966, -0.00272761255193998,
         -0.000496729871956703, 0.00742516405392113,
         0.00320052794640979, 0.00498550335886883, 8.15228468225015e-05,
         -0.00572271018951387, -0.00633303921993278,
         0.000907179147614734, -0.00578705318767714,
         0.00669341010713698, -0.0142669971383604, -0.00326346467621885,
         -0.00167771199489941, -0.00336389182736685,
         -0.00286823209964027, -0.0120688189356146, 0.00435135706418599,
         -0.00034059945833409, -0.00238744997440321,
         -0.00307797780624508, 0.012001676168758, 0.00371590664886234,
         -0.010763271838286, 0.00357234368169923, 0.00567245308836917,
         -0.000337752261929225, 0.00639786675984944,
         -0.00741180854506851, -0.00338725025360986,
         0.00566717524374027, -0.00983225415378008, -0.0142406112483036,
         -0.0140957698003934, 0.00855078938253762, 0.00242971310090656,
         -0.00512665675133839, 0.00824192406828761, 0.00103626952278546,
         0.000862738384976858, -0.009531308617305, 0.0035632071767715,
         -0.0017365637775546, 0.00865281854516464, 0,
         0.00498454108690716, 0.00870609800839883, 0.00220713162604103,
         -0.00612403036678977, 0.00127893609963703,
         -0.00367066868249832, 0.00332977895702236,
         -0.00873218458463132, -0.00517242532498763,
         0.00611780806051865, 0.0143286033530403, 0.00784450060351638,
         0.0026850158772298, -0.00108991836402605, 0.00192750950102472,
         -0.000753800446095632, 0.00367985695840023,
         0.00225140808045765, 0.000166569501509173,
         -0.00467446594069898, 0.0059228536023106, 0.00265802964036244,
         -0.00498961534147657, 0.0036614836612312, 0.000332198325454058,
         -0.00574594577518273, 0.00682482882103397,
         -0.00515593657787683, 0.00424311132051702, 0.00587725709815601,
         -0.000825695695494844, 0.00395713624366767,
         -0.00379194255369164, 0.00346277862708533, 0.00148038517043503,
         -0.0029629651306573, -0.0119404403719185, -0.00761988196002772,
         0.00360784047006746, 0.008091131433142, -0.0012469347806281,
         -0.00642552383919703, -0.0016757440033679, 0.0095143431784841,
         -0.0175972363892889, 0.0141024749691905, 0.0112723945369453,
         0.00542496809686455, 0.00229263999545282, 0.00579002636922432,
         -0.00154616135290198, -0.0023645491876394, 0.00171281800367407,
         -0.000978393881553075, 0.00780047832771569,
         -0.00543766303525661, 0.00430387606573035,
         -0.00145961751506096, 0.00218862811800058, 0.00371777685151553,
         0.00362363000685217, -0.00467290569939216,
         0.000322971339101308, 0.00306303641062922,
         -0.000160978751152285, -0.00629847043439735,
         -0.00243309122464108, -0.000731083254203568, 0.006156856778742,
         -0.00445182652765741, 0.00243072555267076,
         -0.00283642152967456, 0.00178383246848046, -0.0101779977264744,
         -0.00114641348946165, 0.00474089493496521,
         -0.000407813716348571, -0.000652848072803636,
         -0.00458190950511206, -0.00485018830705997,
         0.00107070800493769, -0.00884705427341981, 0.00695194391346465,
         -0.000494967837196825, 0.0109147199841786, 0.00268981700261417,
         -0.00154779876935063, 0.00787693382099786,
         0.000242630111586983, 0.00137379309658492, 0.00499437158659344,
         -0.00257462528574504, -0.00314681342501366,
         -0.00121295450119785, -0.00234922543134619,
         0.00137780140935373, -0.00218916048023221, -0.0115108010004006,
         -0.00692101304298287, 0.00239481513356576, 0.00641291353410445,
         -0.004106107436189, 0.00336825128465623, -0.00312140881004108,
         0.00876444157240908, 0.0027689568957987, -0.00138352005791909,
         -0.0126210493548289, -0.0121978029812766,
         -0.000668114272388109, -0.000167098337760407,
         -0.00578205825910505, -0.00505519654351794,
         -0.00788640932917062, 0.00560320678134829, 0.00574035005282258,
         0.001177757349903, -0.0121808306942341, 0.016794352277449,
         -0.0100934493040166, 0.00126726667574495, 0.010749179751107,
         -0.00175563310570848, -0.00259729524753993,
         -0.00648068589784589, 0.0155834252725775, 0.0024079390552787,
         -0.00340602613805174, 0.0163423907805411, 0.00204457237447642,
         -0.000245128080648804, -0.00360213242540297,
         0.00122945796397289, 0.00212748627827253, 0.00822178916094618,
         0.00356073856835337, -0.00194064910910008,
         -0.00145796235124518, 0.00250961475573863, 0.0110960373000397,
         0.000719395738631334, 0.00327071409596957, 0.00548033618171662,
         0.00576552558683474, 0.00212406168832757, -0.00472627898294764,
         -0.00387643379290115, -0.00111031814087337,
         0.00593379643672609, -0.000552333623542012,
         0.00275862243907987, -0.00220628881553786,
         -0.00434800479454189, -0.00047547350131083,
         0.00435006815603423, -0.00229131376666469, 0.00607233441924038,
         0.00509745055457156, -0.00439009798843326, -0.0043305449355584,
         -0.00688866099518481, 0.00285623805730584,
         0.000712786629789797, 0.00371409807013645, 0.00141877536213375,
         -0.00965579326323862, -0.00015907102554813,
         -0.00734475599403961)

tmsp <- tsp
class(tmsp) <- "mgarch"
sp.t0 <- garchFit(data = tsp, cond.dist = "snorm", include.mean = FALSE)
sp.t1 <- garchFit(data = tsp, cond.dist = "sged", include.mean = FALSE)
sp.t2 <- garchFit(data = tsp, cond.dist = "sstd", include.mean = FALSE)
(sp.mg <- cnmms(tmsp, plot = "gradient", grid = 1000, verb = 4))

summary(sp.mg)
